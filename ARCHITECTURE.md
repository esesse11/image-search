# ğŸ—ï¸ Image Search System - Architecture

## ì‹œìŠ¤í…œ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Layer                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Streamlit UI (Port 8501)          Browser / API Client           â”‚
â”‚  â”œâ”€ ê²€ìƒ‰ ì…ë ¥ì°½                                                    â”‚
â”‚  â”œâ”€ í•„í„° (ìƒ‰ìƒ, ë¸Œëœë“œ, ì‹œì¦Œ)                                      â”‚
â”‚  â”œâ”€ ê²°ê³¼ ì¹´ë“œ (ì¸ë„¤ì¼, ìº¡ì…˜)        â†â”€ HTTP â”€â†’  FastAPI Server   â”‚
â”‚  â””â”€ ìƒì„¸ ë³´ê¸° ëª¨ë‹¬                                (Port 8000)     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Server Layer                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  FastAPI Application                                              â”‚
â”‚  â”œâ”€ POST /search/text        (í…ìŠ¤íŠ¸ â†’ ìœ ì‚¬ ì´ë¯¸ì§€)              â”‚
â”‚  â”œâ”€ GET /asset/{id}          (ì´ë¯¸ì§€ ë©”íƒ€ ì¡°íšŒ)                  â”‚
â”‚  â”œâ”€ POST /feedback           (í”¼ë“œë°± ìˆ˜ì§‘)                       â”‚
â”‚  â””â”€ GET /docs                (Swagger ë¬¸ì„œ)                      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Core Processing Layer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Search Pipeline                                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ 1. Query Text                                              â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 2. OpenAI Embeddings (text-embedding-3-small)            â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 3. Vector Search (FAISS / Qdrant)                         â”‚  â”‚
â”‚  â”‚       Top-k ìœ ì‚¬ ë²¡í„° ì¶”ì¶œ                                 â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 4. Scoring & Ranking                                      â”‚  â”‚
â”‚  â”‚       Caption Sim (0.6) + Attributes Sim (0.3) + ...     â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 5. Return Results                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ingest Pipeline                                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ 1. Image Download (ë¡œì»¬ íŒŒì¼ / URL)                       â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 2. Preprocessing (ë¦¬ì‚¬ì´ì§•, ì •ê·œí™”)                        â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 3. Captioning (OpenAI Vision API)                         â”‚  â”‚
â”‚  â”‚       "íŒŒë€ìƒ‰ ë©´ ë“œë ˆìŠ¤"                                   â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 4. Attribute Extraction (ìƒ‰ìƒ, ì¬ì§ˆ, ìŠ¤íƒ€ì¼)               â”‚  â”‚
â”‚  â”‚       {color: "blue", material: "cotton", ...}            â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 5. Store Metadata (SQLite)                                â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 6. Generate Embeddings (OpenAI)                           â”‚  â”‚
â”‚  â”‚       [0.1, -0.2, ..., 0.8]  (1536 dims)                â”‚  â”‚
â”‚  â”‚       â†“                                                    â”‚  â”‚
â”‚  â”‚ 7. Index (FAISS / Qdrant)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Storage Layer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Metadata DB (SQLite)      Vector Index (FAISS/Qdrant)           â”‚
â”‚  â”œâ”€ images                 â”œâ”€ image vectors                       â”‚
â”‚  â”‚  â”œâ”€ id                  â”œâ”€ 1,536 dims                          â”‚
â”‚  â”‚  â”œâ”€ caption             â””â”€ Cosine similarity search            â”‚
â”‚  â”‚  â”œâ”€ attributes                                                 â”‚
â”‚  â”‚  â”œâ”€ palette            File System                             â”‚
â”‚  â”‚  â””â”€ embedding_vector   â”œâ”€ raw_images/                          â”‚
â”‚  â”‚                        â”œâ”€ processed_images/                    â”‚
â”‚  â”œâ”€ feedback              â”œâ”€ thumbnails/                          â”‚
â”‚  â”‚  â”œâ”€ query              â”œâ”€ index.faiss                          â”‚
â”‚  â”‚  â”œâ”€ image_id           â””â”€ caches/                              â”‚
â”‚  â”‚  â””â”€ relevance          (embedding, caption caches)            â”‚
â”‚  â”‚                                                                 â”‚
â”‚  â””â”€ (ì¶”ê°€ í”¼ë“œë°±ìœ¼ë¡œ í•™ìŠµ ê°€ëŠ¥)                                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 1. **Ingest Pipeline** (`app/ingest/`)

ì´ë¯¸ì§€ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ ì¸ë±ìŠ¤ë¡œ ë³€í™˜

#### 1.1 Downloader (`downloader.py`)
```python
# ì—­í• : ë¡œì»¬ íŒŒì¼ ë˜ëŠ” URLì—ì„œ ì´ë¯¸ì§€ ë¡œë“œ
from app.ingest import Downloader

downloader = Downloader(source_dir="./raw_images")
images = downloader.load_from_directory()
# ë˜ëŠ”
images = downloader.load_from_urls(["https://...", ...])
```

#### 1.2 Preprocessor (`preprocessor.py`)
```python
# ì—­í• : ë¦¬ì‚¬ì´ì§•, ì •ê·œí™”, ì¸ë„¤ì¼ ìƒì„±
from app.ingest import Preprocessor

preprocessor = Preprocessor(
    target_size=(512, 512),
    thumbnail_size=(256, 256)
)
processed = preprocessor.process_image(image)
# â†’ PIL.Image (ì •ê·œí™”ë¨)
```

#### 1.3 Captioner (`captioner.py`)
```python
# ì—­í• : OpenAI Vision APIë¡œ ì´ë¯¸ì§€ ì„¤ëª… ìƒì„±
from app.ingest import Captioner

captioner = Captioner(model="gpt-4-vision")
caption = captioner.generate(image)
# â†’ "íŒŒë€ìƒ‰ ì½”íŠ¼ ë“œë ˆìŠ¤, ì—¬ë¦„ ì‹œì¦Œ, ìºì£¼ì–¼ ìŠ¤íƒ€ì¼"
```

#### 1.4 Extractor (`extractor.py`)
```python
# ì—­í• : ìº¡ì…˜/ì´ë¯¸ì§€ì—ì„œ êµ¬ì¡°í™”ëœ ì†ì„± ì¶”ì¶œ
from app.ingest import Extractor

extractor = Extractor()
attrs = extractor.extract(caption, image)
# â†’ {
#   "color": ["blue"],
#   "material": ["cotton"],
#   "style": ["casual"],
#   "season": ["summer"]
# }
```

#### 1.5 Pipeline (`pipeline.py`)
```python
# ì—­í• : 1.1~1.4 í†µí•© ì‹¤í–‰
from app.ingest import Pipeline

pipeline = Pipeline(config="config.yaml")
for image in pipeline.process_batch(images):
    print(f"âœ“ {image.id}: {image.caption}")
# ëª¨ë“  ë©”íƒ€ë°ì´í„° + ë²¡í„° ìë™ ìƒì„± ë° ì €ì¥
```

**íë¦„:**
```
ì›ë³¸ ì´ë¯¸ì§€
  â†“ Downloader
  â†“ Preprocessor (ë¦¬ì‚¬ì´ì§•)
  â†“ Captioner (ìë™ ì„¤ëª…)
  â†“ Extractor (ì†ì„± ì¶”ì¶œ)
  â†“ Embedder (ë²¡í„°í™”)
  â†“ DB + Index ì €ì¥
```

---

### 2. **Index Layer** (`app/index/`)

ë²¡í„° ì¸ë±ì‹± ë° ê²€ìƒ‰ ì—”ì§„

#### 2.1 Embedder (`embedder.py`)
```python
# ì—­í• : í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜ (1536 dims)
from app.index import Embedder

embedder = Embedder(
    provider="openai",
    model="text-embedding-3-small"
)

query_vector = embedder.embed("íŒŒë€ìƒ‰ ì—¬ë¦„ ë“œë ˆìŠ¤")
# â†’ numpy.array([0.1, -0.2, ..., 0.8], shape=(1536,))

# ë°°ì¹˜ ì²˜ë¦¬ (ìºì‹œ ì§€ì›)
vectors = embedder.embed_batch(captions, use_cache=True)
# â†’ (N, 1536)
```

#### 2.2 FAISS Index (`faiss_index.py`)
```python
# ì—­í• : CPU ê¸°ë°˜ ê³ ì† ë²¡í„° ê²€ìƒ‰ (ì¶”ì²œ)
from app.index import FAISSIndex

index = FAISSIndex(dim=1536, metric="ip")

# ì¸ë±ì‹±
index.add(vectors, ids)
index.save("./app/data/index.faiss")

# ê²€ìƒ‰
scores, ids = index.search(query_vector, k=20)
# â†’ (scores: [0.95, 0.92, ...], ids: ["img_001", "img_002", ...])
```

#### 2.3 Qdrant Index (`qdrant_index.py`)
```python
# ì—­í• : ì„œë²„í˜• ë²¡í„° DB (ì„ íƒì‚¬í•­, ëŒ€ê·œëª¨)
from app.index import QdrantIndex

index = QdrantIndex(
    url="http://localhost:6333",
    collection="images"
)

# QdrantëŠ” ìì²´ í•„í„°ë§ ì§€ì›
results = index.search(
    vector=query_vector,
    filters={"color": "blue", "season": "summer"},
    limit=20
)
```

#### 2.4 Build Script (`build.py`)
```bash
# ë°°ì¹˜ ì¸ë±ì‹± ìŠ¤í¬ë¦½íŠ¸
python -m app.index.build \
  --input ./app/data/raw_images \
  --use faiss \
  --model text-embedding-3-small \
  --batch-size 100

# ì§„í–‰ìƒí™©
# Processing images: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000
# Generating embeddings: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000
# Building index: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000
# Index saved to ./app/data/index.faiss (6.2 MB)
```

---

### 3. **API Layer** (`app/api/`)

ì‚¬ìš©ì ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” REST ì—”ë“œí¬ì¸íŠ¸

#### 3.1 Main App (`main.py`)
```python
# FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”
from fastapi import FastAPI
from app.api import search, assets, feedback

app = FastAPI(title="Image Search API", version="1.0.0")
app.include_router(search.router)
app.include_router(assets.router)
app.include_router(feedback.router)

# ì‹¤í–‰
# uvicorn app.api.main:app --reload
```

#### 3.2 Search Endpoint (`search.py`)
```python
@router.post("/search/text")
async def search_text(query: SearchQuery):
    """
    ì…ë ¥: {
      "query": "íŒŒë€ìƒ‰ ë“œë ˆìŠ¤",
      "w_caption": 0.6,
      "w_attrs": 0.3,
      "filters": {"season": "summer"},
      "top_k": 20
    }

    ì²˜ë¦¬:
    1. ì¿¼ë¦¬ ë²¡í„°í™” (OpenAI)
    2. FAISS ê²€ìƒ‰ (Top-40)
    3. ë©”íƒ€ë°ì´í„° ë¡œë“œ (SQLite)
    4. ìŠ¤ì½”ì–´ë§ & ì •ë ¬
       = caption_sim * 0.6 + attr_sim * 0.3 + ...
    5. í•„í„°ë§ (season, brand ë“±)
    6. Top-20 ë°˜í™˜

    ì¶œë ¥: {
      "results": [
        {
          "id": "img_001",
          "score": 0.92,
          "caption": "íŒŒë€ìƒ‰ ë©´ ë“œë ˆìŠ¤",
          "attributes": {...},
          "thumbnail_url": "/images/thumbnails/img_001.jpg"
        },
        ...
      ],
      "execution_time_ms": 45
    }
    """
```

#### 3.3 Asset Endpoint (`assets.py`)
```python
@router.get("/asset/{id}")
async def get_asset(id: str):
    """ì´ë¯¸ì§€ ìƒì„¸ ì •ë³´ ë°˜í™˜"""
    # SQLiteì—ì„œ ë©”íƒ€ë°ì´í„° ë¡œë“œ
    # ì¸ë„¤ì¼ URL ìƒì„±
    # ìœ ì‚¬ë„ ì ìˆ˜ í¬í•¨ (ìˆìœ¼ë©´)
```

#### 3.4 Feedback Endpoint (`feedback.py`)
```python
@router.post("/feedback")
async def submit_feedback(feedback: FeedbackData):
    """
    ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•œ ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘
    ì…ë ¥: {
      "query": "íŒŒë€ìƒ‰ ë“œë ˆìŠ¤",
      "image_id": "img_001",
      "relevance": 1  # 0(ê´€ë ¨ ì—†ìŒ) ë˜ëŠ” 1(ê´€ë ¨ ìˆìŒ)
    }

    ì‚¬ìš©:
    - ê²€ìƒ‰ ì„±ëŠ¥ í‰ê°€
    - íŒŒì¸íŠœë‹ ë°ì´í„° ìˆ˜ì§‘ (ì¥ê¸°)
    """
```

---

### 4. **UI Layer** (`app/ui/`)

Streamlit ê¸°ë°˜ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤

#### êµ¬ì¡°
```
app/ui/
â”œâ”€â”€ app.py              # ë©”ì¸ í˜ì´ì§€ (ê²€ìƒ‰)
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ detail.py       # ìƒì„¸ë³´ê¸°
â”‚   â”œâ”€â”€ settings.py     # ì„¤ì •
â”‚   â””â”€â”€ history.py      # ê²€ìƒ‰ íˆìŠ¤í† ë¦¬
â””â”€â”€ components/
    â”œâ”€â”€ search_bar.py   # ê²€ìƒ‰ ì…ë ¥
    â”œâ”€â”€ filters.py      # í•„í„° UI
    â”œâ”€â”€ result_card.py  # ê²°ê³¼ ì¹´ë“œ
    â””â”€â”€ palette.py      # íŒ”ë ˆíŠ¸ í‘œì‹œ
```

#### 3.1 Main Page (`app.py`)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Image Search                         â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ "íŒŒë€ìƒ‰ ì—¬ë¦„ ë“œë ˆìŠ¤"              â”‚   â”‚  â† search_bar.py
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  Filter: [ìƒ‰ìƒ] [ë¸Œëœë“œ] [ì‹œì¦Œ]          â”‚  â† filters.py
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ì¸ë„¤ì¼ â”‚ â”‚ ì¸ë„¤ì¼ â”‚ â”‚ ì¸ë„¤ì¼ â”‚ ...  â”‚  â† result_card.py (ë°˜ë³µ)
â”‚  â”‚ ìº¡ì…˜   â”‚ â”‚ ìº¡ì…˜   â”‚ â”‚ ìº¡ì…˜   â”‚       â”‚
â”‚  â”‚ 0.95   â”‚ â”‚ 0.92   â”‚ â”‚ 0.88   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. **Database Layer** (`app/common/database.py`)

#### 5.1 Schema
```python
# SQLAlchemy ORM
class Image(Base):
    __tablename__ = "images"

    id: str = Column(String, primary_key=True)
    caption: str = Column(String)
    attributes: JSON = Column(JSON)  # {"color": ["blue"], ...}
    palette: List[str] = Column(JSON)  # ["#4A90E2", "#FFFFFF"]
    embedding: List[float] = Column(JSON)  # [0.1, -0.2, ...]
    source_url: str = Column(String, nullable=True)
    created_at: datetime = Column(DateTime, default=utcnow)

class Feedback(Base):
    __tablename__ = "feedback"

    id: int = Column(Integer, primary_key=True)
    query: str = Column(String)
    image_id: str = Column(String)
    relevance: int = Column(Integer)  # 0 or 1
    created_at: datetime = Column(DateTime, default=utcnow)
```

#### 5.2 Operations
```python
# CRUD ì˜ˆì‹œ
db.add_image(Image(...))
images = db.get_images(limit=100)
db.add_feedback(Feedback(...))
```

---

## ë°ì´í„° íë¦„ ì˜ˆì‹œ

### Scenario: ì´ë¯¸ì§€ ê²€ìƒ‰

```
User Input: "íŒŒë€ìƒ‰ ì—¬ë¦„ ë“œë ˆìŠ¤"
â”‚
â”œâ”€ UI (Streamlit)
â”‚  â””â”€ POST http://localhost:8000/search/text
â”‚
â”œâ”€ API (FastAPI)
â”‚  â””â”€ search.py:search_text()
â”‚
â”œâ”€ Processing
â”‚  â”œâ”€ 1. Embedder.embed("íŒŒë€ìƒ‰ ì—¬ë¦„ ë“œë ˆìŠ¤")
â”‚  â”‚    â†’ [0.1, -0.2, ..., 0.8] (1536 dims)
â”‚  â”‚
â”‚  â”œâ”€ 2. FAISSIndex.search(vector, k=40)
â”‚  â”‚    â†’ [("img_001", 0.95), ("img_002", 0.92), ...]
â”‚  â”‚
â”‚  â”œâ”€ 3. Database.get_images(["img_001", "img_002", ...])
â”‚  â”‚    â†’ Image(caption="...", attributes={...}, ...)
â”‚  â”‚
â”‚  â”œâ”€ 4. Scoring
â”‚  â”‚    score = caption_sim(0.6) + attr_sim(0.3) + base_sim(0.1)
â”‚  â”‚
â”‚  â”œâ”€ 5. Filtering
â”‚  â”‚    if season == "summer" and color == "blue" ...
â”‚  â”‚
â”‚  â””â”€ 6. Top-20 ì •ë ¬
â”‚
â”œâ”€ Response (JSON)
â”‚  â””â”€ [
â”‚      {"id": "img_001", "score": 0.95, "caption": "...", ...},
â”‚      ...
â”‚    ]
â”‚
â””â”€ UI Rendering
   â””â”€ ê²°ê³¼ ì¹´ë“œ í‘œì‹œ (ì¸ë„¤ì¼, ìº¡ì…˜, íŒ”ë ˆíŠ¸)
```

---

## ë°°í¬ êµ¬ì„± (ì˜ˆ: AWS Lightsail)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Browser   â”‚
â”‚  (Streamlit UI)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ HTTP
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS Lightsail VM (Linux)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Process 1: FastAPI API              â”‚
â”‚  $ uvicorn app.api.main:app \        â”‚
â”‚    --host 0.0.0.0 --port 8000       â”‚
â”‚                                      â”‚
â”‚  Process 2: Streamlit UI             â”‚
â”‚  $ streamlit run app/ui/app.py \    â”‚
â”‚    --server.port 8501                â”‚
â”‚                                      â”‚
â”‚  Nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ, ì„ íƒì‚¬í•­)     â”‚
â”‚  â”œâ”€ :80 â†’ :8501 (Streamlit)         â”‚
â”‚  â””â”€ :8000 â†’ :8000 (API)             â”‚
â”‚                                      â”‚
â”‚  Storage:                            â”‚
â”‚  â”œâ”€ images.db (SQLite)               â”‚
â”‚  â”œâ”€ index.faiss (ë²¡í„° ì¸ë±ìŠ¤)        â”‚
â”‚  â””â”€ /data/ (ì´ë¯¸ì§€ íŒŒì¼)             â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
    OpenAI API
    (embeddings, vision)
```

---

## ì„±ëŠ¥ íŠ¹ì„±

| ì‘ì—… | ì‹œê°„ | ë¹„ìš© |
|------|------|------|
| 1,000ê°œ ì´ë¯¸ì§€ ì¸ë±ì‹± | ~3-4ì‹œê°„ | ~$30-50 |
| ê²€ìƒ‰ ì¿¼ë¦¬ | ~50ms | $0.00001 |
| ìº¡ì…”ë‹ (gpt-4-vision) | ~10s/image | $0.03/image |

---

## ë‹¤ìŒ ë‹¨ê³„

1. âœ… ê¸°ë³¸ êµ¬ì¡° (ARCHITECTURE.md)
2. ğŸ”¨ ê°œë°œ ë¡œë“œë§µ (ROADMAP.md)
3. ğŸ’» êµ¬í˜„ (Phase 1, 2, 3)

